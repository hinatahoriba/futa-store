# トランザクション設計

## 購入処理

### 対象テーブル
- users
- user_balances
- user_items

### フロー
1. トランザクション開始
2. 最新価格取得
3. 残高チェック
4. 在庫チェック
5. 残高更新
6. 出金履歴追加
7. 購入履歴追加
8. コミット

### ロールバック条件
- 残高不足
- 在庫不足
- DBエラー
